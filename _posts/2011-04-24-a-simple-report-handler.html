---
layout: post
title: A Simple Report Handler
published: true
categories: [chef, plugins]
---
<p><a href="http://tickets.opscode.com/browse/CHEF-2179" title="Exception and Report Handlers" target="_blank">Exception and report handlers</a> are a pretty cool feature of Chef. They have been around for several versions (<a href="http://www.opscode.com/blog/2010/06/21/chef-0-9-0-and-ohai-0-5-6-released/" title="Chef 0.9.0 Release Post" target="_blank">first appearing in 0.9.0</a>), but haven't received a lot of attention. In the Chef Advanced training class, we go into greater detail about writing handlers, so I had a play with them a bit recently. Also, the default logging output for a chef-client run is a bit more verbose in Chef 0.10 than it was in previous versions. <a href="http://tickets.opscode.com/browse/CHEF-2179" title="CHEF-2179" target="_blank">I've been convinced</a> this is for the better overall, though all the "Processing..." lines can get in the way of things that are actually being configured. To make it clearer of what resources were actually configured in the Chef run, I wrote a very simple handler:</p>
<p><script src="https://gist.github.com/940171.js"></script></p>
<p>To use this in my chef-client, I drop it off as a file, say "/var/lib/chef/handler/updated_resources.rb" and then configure /etc/chef/client.rb:</p>
<p><script src="https://gist.github.com/940176.js"></script></p>
<p>Then when I run chef-client, after the run is complete it will display something like this:</p>
<div class="CodeRay">
  <div class="code"><pre>[Sun, 24 Apr 2011 22:50:58 -0600] INFO: Chef Run complete in 15.297228 seconds
[Sun, 24 Apr 2011 22:50:58 -0600] INFO: Running report handlers
[Sun, 24 Apr 2011 22:50:58 -0600] INFO: Resources updated this run:
[Sun, 24 Apr 2011 22:50:58 -0600] INFO:   execute[apt-get update]
[Sun, 24 Apr 2011 22:50:58 -0600] INFO:   execute[index-gem-repository]
[Sun, 24 Apr 2011 22:50:58 -0600] INFO:   remote_directory[/srv/gems/gems]
[Sun, 24 Apr 2011 22:50:58 -0600] INFO: Report handlers complete</pre></div>
</div>

<p><strong>Update</strong>: I released a <a href="https://rubygems.org/gems/chef-handler-updated-resources">gem for this handler</a>. You can now install the gem and then use <code>require 'chef/handler/updated_resources'</code> in /etc/chef/client.rb</p>
