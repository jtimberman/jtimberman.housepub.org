---
layout: post
title: Update to Managing my Workstations
published: true
categories: [oldstuff, chef, workstation, osx]
---
<p><em>Update: This post is old and outdated. I'll have another post in 2015 about workstation management with Chef.</em></p>
<p>It has been a few months and several thousand page views since my original post on how I <a href="http://bit.ly/guCtmD" title="Managing My Workstations with Chef" target="_blank">manage my workstations with Chef</a>. I have made some changes to my repository, and have a few additional notes for working with Mac OS X Lion. I also added a new system in my network, an iMac.</p>
<h2>Mac OS X Cookbook</h2>
<p>First, I would like to point out the cookbook I created, <a href="http://ckbk.it/mac_os_x" title="Mac OS X Cookbook" target="_blank">mac_os_x</a>. In the original post, I discussed using Pivotal Lab's workstation recipes, which use the Mac OS X user defaults system to update system preferences from the command-line (with an execute resource). One of the first things I did in the mac_os_x cookbook is create a lightweight resource and provider for managing user defaults. It can be used, for example, like this:</p>
<div class="CodeRay">
  <div class="code"><pre>mac_os_x_userdefaults &quot;dont show hard drives on the desktop&quot; do
  domain &quot;com.apple.finder&quot;
  key &quot;ShowHardDrivesOnDesktop&quot;
  value &quot;false&quot;
  type &quot;bool&quot;
end</pre></div>
</div>

<p>While this does involve more typing than just entering the command, it has a couple advantages. First, it is easier to read for people not totally familiar with the defaults command. Second, behind the scenes it will check if the setting is already set and not update the resource if it isn't. This isn't a huge deal in terms of system resource usage, but depending on your Chef setup might end up with extra reporting on things that didn't need to change if you're using a report handler, which <a href="http://bit.ly/pdMawh" title="A Simple Report Handler" target="_blank">I do use</a>.</p>
<p>This cookbook also includes a lightweight resource/provider for managing plist preferences files for <code>~/Library/Preferences</code>. All plists in OS X can be manipulated through the defaults system, but it can be cumbersome for highly customized applications such as your Adium or 1Password configuration. Usage is very simple:</p>
<div class="CodeRay">
  <div class="code"><pre>mac_os_x_plist_file &quot;ws.agile.1Password.plist&quot;</pre></div>
</div>

<p>This is in my local <a href="http://ckbk.it/1password" title="1Password Cookbook" target="_blank">1password cookbook</a>, which has the file in <code>files/default/ws.agile.1Password.plist</code>. If I make modifications to the preferences, I do have to copy it over to the cookbook and re-upload to the Chef Server, but since I now have 4 computers to change preferences on, this is much easier than remembering everywhere I clicked. I use this for managing my preferences for <a href="http://ckbk.it/ghmac" title="GitHub for Mac" target="_blank">ghmac (GitHub for Mac)</a>, <a href="http://ckbk.it/iterm2" target="_blank">iterm2</a> and alfredapp.</p>
<h2>Mac OS X Lion</h2>
<p>Lion brought a lot of changes. In particular along with Xcode 4, Apple changed the gcc compiler to llvm. I'm not a C programmer, and don't really understand the differences yet, I just know that a number of things in <a href="http://github.com/mxcl/homebrew">Homebrew</a> fail to build. The main thing I installed with Homebrew that wasn't working with Lion is <a href="http://bit.ly/jIYjkc">Emacs</a>. I actually only have Lion on my iMac, so I haven't updated any recipes for installing it via Chef. In fact, I actually removed it from my "workstation" recipe and *gasp* installed it manually. The story there is enough for another post though, so stay tuned and I'll write up my experience.</p>
<p>Relevant to how I manage workstations with Chef, I had to make sure that on Lion, I take care of some additional new preferences using my handy-dandy "mac_os_x_userdefaults" LWRP. These are in the mac_os_x cookbook recipe, "lion_tweaks." In my workstation recipe, I include this one only on Lion.</p>
<h2>Conclusion</h2>
<p>If you haven't read it yet, go back and read my post on how I <a href="http://bit.ly/guCtmD" title="Managing My Workstations with Chef" target="_blank">manage my workstations with Chef</a>. I hope if you're using Chef to manage a Mac that the <a href="http://ckbk.it/mac_os_x" title="Mac OS X Cookbook" target="_blank">mac_os_x</a> cookbook is useful to you. Also, stay tuned for an update later this week about my experiences installing Emacs on Lion.</p>
